<html>
  <head>
    <title>Carena</title>
    <script type="text/javascript" src="lib/carena.js"></script>
    <script type="text/javascript">
      var mapRecursive = function(node, fn) {
        fn(node);
        var i = 0, len = node.children.length;
        for (i; i<len; i++) {
          mapRecursive(node.children[i], fn);
        }
      };
    </script>
  </head>
  <body>
    <h1>Carena</h1>
    <p>
      lightweight Javascript 2d scene graph for use with canvas
    </p>
    <h2>License</h2>
    <p>
      MIT, see <a href="LICENSE.txt">LICENSE.txt</a>
    </p>
      <h2>Demos</h2>
      <canvas width="300" height="300" id="mouse-canvas"></canvas>
      <script type="text/javascript">
        var renderer = carena.Build({}, [carena.feature.Renderer], {canvas: document.getElementById("mouse-canvas")});
            camera   = carena.Build({}, [carena.feature.Camera], { renderer: renderer});
            node    = carena.Build({}, [carena.feature.Node, carena.feature.Eventable, carena.feature.Draggable]),
            mouse   = {x:0, y:0},
            fps     = 1000/30;
        camera.target = node;

        node.width=100;
        node.height=100;
        node.x = 100;
        node.y = 100;
        node.color = "red";
        node.render = function(ms) {
          renderer.context.fillStyle = node.color;
          renderer.context.fillRect(node.x, node.y, node.width, node.height);
        };

        node.event.bind("mouse.in", function(name, data) {
          node.color="blue";
        });
        
        node.event.bind("mouse.out", function(name, data) {
          node.color="red";
        });

        node.event.bind("mouse.down", function(name, data) {
          node.color="green";
        });

        node.event.bind("mouse.up", function(name, data) {
          node.color="blue";
        });

        node.event.bind("drag.move", function(name, data) {
          node.color="orange";
        });

        setTimeout(function render() {
          if (node.dirty === true) {
            console.log("clearing..");
            renderer.context.fillStyle = "black";
            renderer.context.fillRect(0, 0, renderer.canvas.width, renderer.canvas.height);
            node.clean();
          }

          node.render((new Date()).getTime());
          setTimeout(render, fps)
        }, fps);
      </script>
  </body>
</html>
