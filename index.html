<html>
  <head>
    <title>Carena</title>
    <script type="text/javascript" src="lib/carena.js"></script>
    <script type="text/javascript">
      function mapRecursive(node, fn) {
        fn(node);
        var i=0; len = node.children.length;
        for (i; i<len; i++) {
          mapRecursive(node.children[i], fn);  
        }
      };
    </script>
  </head>
  <body>
    <h1>Carena</h1>
    <p>
      lightweight Javascript scene graph for use with canvas
    </p>
    
    <h2>License</h2>
    <p>
      MIT, see <a href="LICENSE.txt">LICENSE.txt</a>
    </p>
    <p>
      <h2>Demos</h2>
      Since its fairly difficult to visualize a scene graph, these are all
      renderings.
    <p>
    <p>
      <h3>Simple rendering</h3>
      <canvas id="simple" width="200" height="200"></canvas>
      <script type="text/javascript">
        (function() {
          var canvas = document.getElementById("simple");
          var ctx = canvas.getContext("2d");

          // a single square
          var scene = new carena.node();
          scene.height = 50;
          scene.width  = 50

          scene.update = (function() {
            var delta = 1;
            return function(time) {  
              scene.x+=delta;
              scene.y+=delta;
              if (scene.x+scene.width  > canvas.width || 
                  scene.y+scene.height > canvas.height) 
              {
                delta = -1;
              } else if (scene.x < 0 || scene.y < 0) {
                delta = 1;
              }
            }          
          })();

          scene.render = function(time) {
            ctx.fillStyle ="#FF6600";
            ctx.fillRect(scene.x,scene.y,scene.width,scene.height)
          };      
          
          
          // render..
          var ms = 0, interval = 16;
          setInterval(function() {
            ctx.fillStyle = "#000000";
            ctx.fillRect(0,0,canvas.width,canvas.height);
            
            ms+=interval;

            mapRecursive(scene, function(node) {
              node.update(ms);
            });

            mapRecursive(scene, function(node) {
              node.render(ms);
            });
          }, interval);
            
        })();
      </script>
    </p>

    <p>
      <h3>Relative rendering</h3>
      <canvas id="relative" width="200" height="200"></canvas>
      <script type="text/javascript">
        (function() {
          var canvas = document.getElementById("relative");
          var ctx = canvas.getContext("2d");

          // a single square
          var scene = new carena.node();
          scene.height = 50;
          scene.width  = 50

          scene.update = (function() {
            var delta = 1;
            return function(time) {  
              scene.x+=delta;
              scene.y+=delta;
              if (scene.x+scene.width  > canvas.width || 
                  scene.y+scene.height > canvas.height) 
              {
                delta = -1;
              } else if (scene.x < 0 || scene.y < 0) {
                delta = 1;
              }
            }          
          })();

          scene.render = function(time) {
            ctx.fillStyle ="#FF6600";
            ctx.fillRect(scene.x,scene.y,scene.width,scene.height)
          };
          
          var child = new carena.node();
          scene.add(child);
          child.height = 30;
          child.width  = 30;
          
          child.update = (function() {
            var delta = 1, y=0;
            
            return function(time) {  
              y+=delta
              child.y += y;
              child.x += child.parent.width/2-child.width/2;
              if (child.y+child.height > child.parent.y + child.parent.height) 
              {
                delta = -1;
              } else if (child.y < child.parent.y) {
                delta = 1;
              }
            }          
          })();

          child.render = function(time) {
            ctx.fillStyle ="#0000AA";
            ctx.fillRect(child.x,
                         child.y,
                         child.width,
                         child.height);
          };
          


          var grand = new carena.node();
          grand.height = 10;
          grand.width  = 10;
          
          grand.update = (function() {
            var delta = 1, x = 0;
            return function(time) { 
              x+=delta; 
              grand.x += x;// (time/20) * delta;
              grand.y += (grand.parent.height/2-grand.height/2);
              if (grand.x+grand.width > child.x+child.width) 
              {
                delta = -1;
              } else if (grand.x < child.x) {
                delta = 1;
              }
            }          
          })();

          grand.render = function(time) {
            ctx.fillStyle ="#00FF00";
            ctx.fillRect(grand.x,
                         grand.y,
                         grand.width,
                         grand.height);
          };
          child.add(grand);
          
          
          // render..
          var ms = 0, interval = 16;
          setInterval(function() {
            ms+=interval;

            mapRecursive(scene, function(node) {
              node.x = node.parent.x;
              node.y = node.parent.y;
              node.update(ms);
            });

            ctx.fillStyle = "#000000";
            ctx.fillRect(0,0,canvas.width,canvas.height);
            mapRecursive(scene, function(node) {
              node.render(ms);
            });
          }, interval);
            
        })();
        
      </script>
      
    </p>
    


    <p>
      more coming soon..
    </p>
  </body>
</html>
