<html>
  <head>
    <title>Carena</title>
    <script type="text/javascript" src="lib/carena.js"></script>
    <script type="text/javascript">
      var mapRecursive = function(node, fn) {
        fn(node);
        var i = 0, len = node.children.length;
        for (i; i<len; i++) {
          mapRecursive(node.children[i], fn);
        }
      };
    </script>
  </head>
  <body>
    <h1>Carena</h1>
    <p>
      lightweight Javascript 2d scene graph for use with canvas
    </p>
    <h2>License</h2>
    <p>
      MIT, see <a href="LICENSE.txt">LICENSE.txt</a>
    </p>
      <h2>Demos</h2>
      <canvas width="300" height="300" id="mouse-canvas"></canvas>
      <script type="text/javascript">
        var canvas  = document.getElementById("mouse-canvas"),
            context = canvas.getContext("2d"),
            node    = carena.Build({}, [carena.feature.Node]),
            mouse   = {x:0, y:0},
            fps     = 1000/30;
        context.fillStyle = "#000000";

        node.width=100;
        node.height=100;
        node.x = 100;
        node.y = 100;
        node.color = "red";
        node.render = function(ms) {
          context.fillStyle = node.color;
          context.fillRect(node.x, node.y, node.width, node.height);
        };

        document.addEventListener("mousemove", function(ev) {
          mouse.x = ev.clientX - (canvas.offsetLeft - window.pageXOffset);
          mouse.y = ev.clientY - (canvas.offsetTop  - window.pageYOffset);
          console.log(mouse.x + " - " + mouse.y);
          // attempt to pick a node
          if (node.containsPoint(mouse.x, mouse.y, true)) {
            node.color="blue";
          } else {
            node.color="red";
          }
        });
        
        document.addEventListener("mousedown", function(ev) {
          if (node.containsPoint(mouse.x, mouse.y, true)) {
            node.color="green";
          } else {
            node.color="blue";
          }
        });

        document.addEventListener("mouseup", function(ev) {
          if (node.containsPoint(mouse.x, mouse.y, true)) {
            node.color="blue";
          }
        });

        context.fillRect(0, 0, canvas.width, canvas.height);
        
        setTimeout(function render() {
          node.render((new Date()).getTime());
          setTimeout(render, fps)
        }, fps);
      </script>
  </body>
</html>
